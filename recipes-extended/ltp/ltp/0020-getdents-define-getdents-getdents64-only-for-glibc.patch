From aa3568e6ac28f377e75ce16b11e3c7738a373e53 Mon Sep 17 00:00:00 2001
From: Khem Raj <raj.khem@gmail.com>
Date: Fri, 8 Jan 2016 06:57:04 +0000
Subject: [PATCH 20/32] getdents: define getdents/getdents64 only for glibc

getdents/getdents64 are implemented in musl and when we define static
functions with same name, it errors out.

Signed-off-by: Khem Raj <raj.khem@gmail.com>

Upstream-Status: Pending
---
 testcases/kernel/syscalls/getdents/getdents.h | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/testcases/kernel/syscalls/getdents/getdents.h b/testcases/kernel/syscalls/getdents/getdents.h
index c24ed6c99..dadb7c560 100644
--- a/testcases/kernel/syscalls/getdents/getdents.h
+++ b/testcases/kernel/syscalls/getdents/getdents.h
@@ -37,6 +37,7 @@ struct linux_dirent {
 #if HAVE_GETDENTS
 #include <unistd.h>
 #else
+#ifdef __GLIBC__
 static inline int
 getdents(unsigned int fd, struct linux_dirent *dirp, unsigned int size)
 {
@@ -44,6 +45,7 @@ getdents(unsigned int fd, struct linux_dirent *dirp, unsigned int size)
 }
 
 #endif /* HAVE_GETDENTS */
+#endif /* __GLIBC__ */
 
 struct linux_dirent64 {
 	uint64_t	d_ino;
@@ -56,10 +58,12 @@ struct linux_dirent64 {
 #if HAVE_GETDENTS64
 #include <unistd.h>
 #else
+#ifdef __GLIBC__
 static inline int
 getdents64(unsigned int fd, struct linux_dirent64 *dirp64, unsigned int size)
 {
 	return ltp_syscall(__NR_getdents64, fd, dirp64, size);
 }
 #endif /* HAVE_GETDENTS64 */
+#endif /* __GLIBC__ */
 #endif /* GETDENTS_H */
-- 
2.7.0

